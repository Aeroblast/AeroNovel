本文档解释自称 ATXT 的文本文件格式。其他乱七八糟的项目文件详见 [项目文件解释](reference.md) 。
## ATXT 格式解释

总体的设计思路是一行一个段落（空行也会生成空段落），特殊格式的需求参考 bbcode 在正则表达式范围内解决，尽量不写嵌套标签。这样一来编辑文本时比较直观。如果没有特殊的格式，则与一般纯文本的小说无二。

为了方便编辑器给文本着色，后缀名给 txt 加了个 a，所以是 atxt （超随便）。


## 标签
标签的设计原则是在单行内结束，因此不像一些论坛的 bbcode 实现可以跨行。`#`出现在行首意味着该行做特殊处理。比如`##`注释，`#HTML:`插入代码。

本工具设计初期写死了所有 TAG，但后来加入了 macros.txt。这东西直接使用 C# 自带的正则引擎，具体写法请参考微软的文档。可以自创标签，也可以放其他的处理。小心别写出死循环。


## 自动处理
对于以`「『`等字符开头的行，生成的段落将被标记，用于对齐等用途。此功能可通过项目设置关闭。默认情况下，一般段落 text-indent 为 2em，而被标记的段落是1.5em，对于大部分字体可达到视觉上对齐。可以通过 CSS 覆盖 atxt_drawout 类，修改为其他值。

转换工具遇到可疑的```[xxx]```将会产生警告。

使用内置标签引用图片时会记录图片引用，并进行一些验证，比如查找图片文件或引用是否存在。

通过项目设置开启 AutoSpace 功能后，会尝试保证在英文和中文交界的地方加空格。

### 注释

`[note]`注释标记

`[note=注释内容]`注释内容

注释标记将生成一个epub:type为noteref的上角标链接，并且分配id、href，与注释内容对应。注释标记的内容默认为“注”，如果对应注释内容有半角冒号`:`，注释标记内容将是冒号前的部分。比如`[note][note=译注:balabala]`将会生成内容为`[译注]`的角标链接。

注释内容按顺序分配给注释标记，所以写在哪里也没关系。需要注意的是，注释内容tag不应该占一个空行。转换为HTML时，注释内容被统一加在文档的最后aside标签内的注释区域。支持aside的阅读器将自动隐藏。

### 图片相关

`[img]图片名称[/img]`一般图片

`#illu:图片名称`单独一行。用于插图，将使用div包裹并赋予一些预设样式。

`[imgchar]图片名称[/imgchar]`图片字符

生成HTML时，将会检查目录中`Images`文件夹是否存在相应图片。如果需要发布到论坛，请额外写web_images.txt或web_images.md，定义文件名和网络图片地址的对应关系。

一般图片 将简单地生成HTML的img标签。

插图 将会生成一个div包裹的img，具体样式可以参考 template 中的CSS。效果依阅读器而异：Apple Books 的翻页模式将使图片在一页里居中显示，Apple Books 的滚动模式将占用一屏幕的高度，Kindle 简单地占用一页没有居中。

图片字符 生成一个1em高的图片，用于将图片显示为字符，所谓的「外字」gaiji。

### 类

#### 在段落之内的情况

`[class=类名]内容[/class]`

可以自己在 style.css 里定义样式类，该标签单独一行时将生成 p 标签，否则为 span 标签。

#### 为多个段落添加格式

`#class:类名`

`#/class`

单独一行使用该语法，则会最终生成 div 块包裹中间的段落。请注意若要对段落生效需要用子元素选择器。

### 书内链接

`[chapter=章节编号]链接文字[/chapter]`

用章节编号查找对应的 XHTML 路径，生成链接。

### 对齐规则

`#center:内容`
`#left:内容`
`#right:内容`

单独一行使用。


### 一般样式
以下样式仅做简单的正则替换。

`#title:内容`单独一行。一个预设的类。

`[ruby=注音]内容[/ruby]`注音，

`[pagebreak]`单独一行。生成一个pagebreak段落。

`[b]内容[/b]`加粗。

`[s]内容[/s]`删除线。

`[i]内容[/i]`斜体。

`[color=颜色]内容[/color]`颜色值直接喂给CSS样式color，那边合法就可以。

`[size=大小]内容[/size]`大小只写数字，单位是 em。

`#h1:内容`到`#h6:内容` 单独一行。简单翻译为 HTML 版。


## 注释
指在成品中不会输出的备注。

注释分为行内注释和单行注释。

### 行内注释

和Tag一起正则处理，范围是行内。

`\*注释内容*\`

`\\\注释内容`直到行尾都是注释内容，前面的不影响。

### 单行注释

`##注释内容`

该行将跳过处理。必须出现在行首。

需要注意的是，`\\\注释内容`和`##注释内容`看起来类似，实际上不一样。如果该行只有`\\\注释内容`，则该行会最终变成`<p><br/></p>`，而`##注释内容`不会产生任何代码。

### 直接插入HTML代码

`#HTML:内容`冒号后面是HTML代码，将会被原封不动地加入生成的文档。
