## 项目文件夹结构

一本小说放入一个文件夹处理。文件夹有以下内容：


+ \*.atxt / \*.txt [文本文件](#%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6)。主要内容物。具体格式见下文。
+ Images 文件夹
    + cover.jpg 必须。
    + \*.jpg / \*.png 其他图片资源
+ toc.txt 必须。定义目录。具体格式见下文。
+ meta.txt 或 meta3.txt 必须。元数据。优先使用meta3.txt。
+ style.css 可选。定义样式。
+ macros.txt 可选。自定义宏。
+ web_images.txt 或 web_images.md 可选。用于bbcode中替换图片为图床链接。
+ patch_t2s 文件夹。可选。用于繁体转换的特殊规则。
    + Images 文件夹。可选。内容为替换用的图片。
    + patch.csv 可选。内容为特殊情况的替换文本。


### 文本文件
#### 命名
文件名必须以两位数字开头，作为文件的顺序索引。数字后面如果有文本，将作为章节标题。章节特殊字符可以用URL转码表示。

文件拓展名是`.atxt`或`.txt`，实际内容没有差别。`.atxt`的扩展名用于区分普通的文本文档和含有本工具对应标记的文本，以使用VSCode插件的着色等功能。

标题为info的文档将会被加入生成信息、日期。

#### 格式

以*行*为单位进行处理，一行转换为一个段落。具体可以参考atxt-format.md。

### 目录 toc.txt

该文件将会用于生成EPUB的目录。一行一个目录项，使用数字即可表示链接目标。

需要层级表示时，以`[名称]章节索引`为标题开始添加子层级项目。比如`[正文]10`；以`[/]`单独一行返回上一级。`/`后面写点别的也不影响，比如`[/正文]`便于编辑。

### 元数据 meta.txt 或 meta3.txt

对应EPUB中.OPF文件对应的metadata部分。meta.txt对应EPUB2.0，meta.txt对应EPUB3.0。请使用meta3.txt，现在已经不对旧版做维护。

提供了一些模板，生成时替换成对应的内容。
+ `{urn:uuid}`生成一个uuid
+ `{date}`生成标准格式的日期

### 宏定义 macros.txt

使用正则表达式定义宏。一行定义一条规则，分别写搜索模式、用于EPUB的替换、用于bbcode的替换(可选)，使用tab隔开。替换使用`$0`、`$1`引用组。

宏处理先于正常规则运行。推荐在宏处理中使用正常规则，格式。比如:
`小标题:(.*)    #center:[b]$1[/b]`
是可行的。所以可以不写bbcode用替换，运行bbcode时使用EPUB的替换。

另外注意不要写出死循环。
